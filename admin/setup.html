<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi·∫øt l·∫≠p CMS - Printhub Admin</title>
    <link rel="stylesheet" href="../styles.css?v=20260107v1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .setup-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .setup-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .setup-header p {
            color: #888;
        }

        .setup-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .setup-card h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .setup-card h2 .step-num {
            background: var(--primary-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .setup-card p {
            color: #bbb;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .setup-card code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            color: #e0e0e0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ccc;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group .help-text {
            font-size: 0.85rem;
            color: #888;
            margin-top: 0.5rem;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .status-indicator.success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        .status-indicator.error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .status-indicator.pending {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            color: #ff9800;
        }
    </style>
</head>

<body>
    <div class="setup-container">
        <div class="setup-header">
            <div class="navbar-brand" style="justify-content: center; margin-bottom: 1rem;">
                <span class="logo-print">Print</span><span class="logo-hub">hub</span>
            </div>
            <h1>üöÄ Thi·∫øt l·∫≠p CMS Backend</h1>
            <p>L√†m theo c√°c b∆∞·ªõc d∆∞·ªõi ƒë√¢y ƒë·ªÉ k·∫øt n·ªëi website v·ªõi Supabase</p>
        </div>

        <!-- Step 1: Create Supabase Project -->
        <div class="setup-card">
            <h2><span class="step-num">1</span> T·∫°o Supabase Project</h2>
            <p>
                1. Truy c·∫≠p <a href="https://supabase.com" target="_blank"
                    style="color: var(--primary-color);">supabase.com</a> v√† ƒëƒÉng k√Ω/ƒëƒÉng nh·∫≠p<br>
                2. Nh·∫•n "New Project" v√† ƒëi·ªÅn th√¥ng tin:<br>
                &nbsp;&nbsp;&nbsp;‚Ä¢ <strong>Name:</strong> printhub-cms<br>
                &nbsp;&nbsp;&nbsp;‚Ä¢ <strong>Database Password:</strong> (t·∫°o m·∫≠t kh·∫©u m·∫°nh)<br>
                &nbsp;&nbsp;&nbsp;‚Ä¢ <strong>Region:</strong> Singapore (g·∫ßn Vi·ªát Nam nh·∫•t)<br>
                3. Ch·ªù 2-3 ph√∫t ƒë·ªÉ project ƒë∆∞·ª£c t·∫°o
            </p>
        </div>

        <!-- Step 2: Get API Keys -->
        <div class="setup-card">
            <h2><span class="step-num">2</span> L·∫•y API Keys</h2>
            <p>
                Trong Supabase Dashboard, v√†o <strong>Settings ‚Üí API</strong> v√† copy:
            </p>

            <div class="form-group">
                <label>Project URL</label>
                <input type="text" id="supabase-url" placeholder="https://xxxxx.supabase.co">
                <div class="help-text">T√¨m ·ªü m·ª•c "Project URL"</div>
            </div>

            <div class="form-group">
                <label>Anon/Public Key</label>
                <input type="text" id="supabase-key" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                <div class="help-text">T√¨m ·ªü m·ª•c "anon public" trong Project API keys</div>
            </div>
        </div>

        <!-- Step 3: Run Schema -->
        <div class="setup-card">
            <h2><span class="step-num">3</span> T·∫°o Database Schema</h2>
            <p>
                1. Trong Supabase Dashboard, v√†o <strong>SQL Editor</strong><br>
                2. Copy n·ªôi dung file <code>supabase/schema.sql</code> t·ª´ project<br>
                3. Paste v√†o SQL Editor v√† nh·∫•n <strong>Run</strong>
            </p>
            <div class="code-block">
                <pre>-- ƒê∆∞·ªùng d·∫´n file schema:
/admin/../supabase/schema.sql

-- Ho·∫∑c download t·ª´:
https://github.com/Neiv-LV/printhub-website/blob/main/supabase/schema.sql</pre>
            </div>
        </div>

        <!-- Step 4: Create Storage Bucket -->
        <div class="setup-card">
            <h2><span class="step-num">4</span> T·∫°o Storage Bucket</h2>
            <p>
                1. V√†o <strong>Storage</strong> trong Supabase Dashboard<br>
                2. Nh·∫•n <strong>New Bucket</strong><br>
                3. ƒê·∫∑t t√™n: <code>media</code><br>
                4. Ch·ªçn <strong>Public bucket</strong> ƒë·ªÉ cho ph√©p public access
            </p>
        </div>

        <!-- Step 5: Create First Admin User -->
        <div class="setup-card">
            <h2><span class="step-num">5</span> T·∫°o Admin User ƒë·∫ßu ti√™n</h2>
            <p>
                1. V√†o <strong>Authentication ‚Üí Users</strong><br>
                2. Nh·∫•n <strong>Add User ‚Üí Create New User</strong><br>
                3. ƒêi·ªÅn email v√† password cho admin<br>
                4. Sau khi t·∫°o xong, ch·∫°y SQL sau ƒë·ªÉ set role Super Admin:
            </p>
            <div class="code-block">
                <pre>UPDATE public.profiles 
SET role = 'super_admin' 
WHERE email = 'your-admin-email@example.com';</pre>
            </div>
        </div>

        <!-- Connection Test -->
        <div class="setup-card">
            <h2><span class="step-num">6</span> Ki·ªÉm tra k·∫øt n·ªëi</h2>

            <div id="connection-status" class="status-indicator pending">
                ‚è≥ Ch∆∞a ki·ªÉm tra k·∫øt n·ªëi
            </div>

            <div class="btn-group">
                <button class="btn-primary" id="test-connection">Ki·ªÉm tra k·∫øt n·ªëi</button>
                <button class="btn-secondary" id="save-config">L∆∞u c·∫•u h√¨nh</button>
            </div>
        </div>

        <!-- Navigation -->
        <div style="text-align: center; margin-top: 2rem;">
            <a href="login.html" class="btn-outline" style="text-decoration: none;">‚Üê Quay l·∫°i trang ƒëƒÉng nh·∫≠p</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const urlInput = document.getElementById('supabase-url');
        const keyInput = document.getElementById('supabase-key');
        const statusEl = document.getElementById('connection-status');
        const testBtn = document.getElementById('test-connection');
        const saveBtn = document.getElementById('save-config');

        // Load saved config
        const savedUrl = localStorage.getItem('SUPABASE_URL');
        const savedKey = localStorage.getItem('SUPABASE_ANON_KEY');
        if (savedUrl) urlInput.value = savedUrl;
        if (savedKey) keyInput.value = savedKey;

        testBtn.addEventListener('click', async () => {
            const url = urlInput.value.trim();
            const key = keyInput.value.trim();

            if (!url || !key) {
                statusEl.className = 'status-indicator error';
                statusEl.innerHTML = '‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß URL v√† Key';
                return;
            }

            statusEl.className = 'status-indicator pending';
            statusEl.innerHTML = '‚è≥ ƒêang ki·ªÉm tra...';

            try {
                const client = window.supabase.createClient(url, key);

                // Try to fetch site settings
                const { data, error } = await client
                    .from('site_settings')
                    .select('*')
                    .limit(1);

                if (error) {
                    statusEl.className = 'status-indicator error';
                    statusEl.innerHTML = `‚ùå L·ªói: ${error.message}`;
                } else {
                    statusEl.className = 'status-indicator success';
                    statusEl.innerHTML = '‚úÖ K·∫øt n·ªëi th√†nh c√¥ng! ƒê√£ t√¨m th·∫•y database.';
                }
            } catch (err) {
                statusEl.className = 'status-indicator error';
                statusEl.innerHTML = `‚ùå L·ªói k·∫øt n·ªëi: ${err.message}`;
            }
        });

        saveBtn.addEventListener('click', () => {
            const url = urlInput.value.trim();
            const key = keyInput.value.trim();

            if (!url || !key) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß URL v√† Key');
                return;
            }

            localStorage.setItem('SUPABASE_URL', url);
            localStorage.setItem('SUPABASE_ANON_KEY', key);

            alert('‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh! B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng Admin Panel.');
            window.location.href = 'login.html';
        });
    </script>
</body>

</html>